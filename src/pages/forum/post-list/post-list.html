<template ngbModalContainer></template>
<base-header [title]="title"></base-header>

<section class="content">
    
    <edit-component *ngIf=" showPostCreateForm "
        [post_id] = " post_id "
        [mode] = " 'create-post' "
        (error) = " onError( $event ) "
        (cancel) = " onCancel() "
        (success) = " onSuccess() "
    ></edit-component>

    <div *ngIf=" pages.length " class="pages">
        <div *ngFor=" let page of pages " class="page posts">
        {{ 'forum.' + title | ln }}
        <button (click)="onClickPostCreate()">Post Write</button>
            <article
                class="post"
                *ngFor=" let post of page.posts; trackBy post.idx "
                [class.hidden]=" hideContent[ post.idx.toString() ] "
            >
                <div class="header">
                    <h2 class="post-header-title">{{ post.subject }}</h2>
                    idx: {{ post.idx }}
                    <button (click)="onClickPostEdit( post )">Edit</button>
                    <button (click)="onClickPostDelete( post )">Delete</button>
                </div>

                <div class="content" innerHTML="{{ post.content }}">
                </div>
                
                <div *ngIf=" post.photos.length " class="uploaded-files">
                    <img *ngFor=" let photo of post.photos " [src]=" photo.url_thumbnail ">
                </div>

                <!-- edit post -->
                <edit-component *ngIf=" showEditComponent[ post.idx.toString() ] "
                    [current] = " post "
                    [mode] = " mode "
                    (error) = " onError( $event ) "
                    (cancel) = " onCancel() "
                    (success) = " onSuccess() "
                ></edit-component>
                
                <!-- reply a comment -->
                <edit-component *ngIf=" ! hideContent[ post.idx.toString() ] "
                    [root] = " post "
                    [current]=" post "
                    [mode]=" 'create-comment' "
                    (error) = " onError( $event ) "
                    (cancel) = " onCancel() "
                    (success) = " onSuccess() "
                ></edit-component>
                
                <div class="comments" *ngIf=" post.comments ">
                    <article class="comment" *ngFor=" let comment of post.comments; trackBy comment?.idx "
                        [attr.depth]="comment.depth"
                        [class.hidden]=" hideContent[ comment.idx.toString() ] "
                    >
                        <div class="header">
                            No. {{ comment.idx }}
                            <span class="buttons">
                                <button (click)="onClickCommentReply( comment )">Reply</button>
                                <button (click)="onClickCommentEdit( comment )">Edit</button>
                                <button (click)="onClickCommentDelete( comment  )">DELETE</button>
                                <button (click)="onClickCommentLike( comment  )">Like</button>
                                <button (click)="onClickCommentDislike( comment  )">Dislike</button>
                                <button (click)="onClickCommentReport( comment  )">Report</button>
                            </span>
                        </div>
                        <div class="content">
                            <div innerHTML="{{ comment.content }}"></div>
                            <div *ngIf=" comment.photos.length " class="uploaded-files">
                                <img *ngFor=" let photo of comment.photos " [src]=" photo.url_thumbnail ">
                            </div>
                        </div><!--/content-->
                        
                        <!-- reply or edit a comment -->
                        <edit-component *ngIf=" showEditComponent[ comment.idx.toString() ] "
                            [root] = " post "
                            [current] = " comment "
                            [mode] = " mode "
                            (error) = " onError( $event ) "
                            (cancel) = " onCancel() "
                            (success) = " onSuccess() "
                        ></edit-component>

                    </article>
                </div>


            </article><!-- post -->
        </div><!--/page posts-->
    </div><!--pages-->
    <div *ngIf=" inPageLoading " class="in-page-loading"><i class="fa fa-spinner fa-spin"></i> Loading ...</div>
    <div *ngIf=" noMorePosts " class="no-more-posts">No more posts</div>
</section>


<base-footer></base-footer>

